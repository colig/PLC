{"ast":null,"code":"import _classCallCheck from \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/src/components/NetworkMap.js\";\nimport \"../css/NetworkMap.css\";\nimport React from \"react\";\nimport networkIcon from \"../assets/connection.png\";\nimport zc from \"@dvsl/zoomcharts\";\nimport AnnotSidebar from \"./Sidebar\";\nimport { connect } from \"react-redux\";\nimport { fetchFullAnnot, fetchPageAnnots } from \"../actions\";\nimport { Menu, Segment, Sidebar } from \"semantic-ui-react\";\nvar Chart = zc.NetChart; // Zoomcharts license and license key\n\nwindow.ZoomChartsLicense = \"ZCP-dq3x184y6: ZoomCharts SDK Internal Use license for University of Minnesota. Valid for 1 chart developer and 1 external site license\";\nwindow.ZoomChartsLicenseKey = \"9ecdcfd309df4b4a9bb8ffca5c2f3c0561911045d450c36abc\" + \"65fd86ce49f03a893df118954e43bae3c044def8f1561828f71b123765f399104720eff951e74\" + \"3c7e68f18633262026c2cb4350f0e7cee21923ec226f943df31aa64c1f36c35bf660407fa18ea\" + \"2701c1b52d6576340539a77d626789b65c4d6b66905da423631579634876a14661d2ffd77660b\" + \"43c2ffed1e2d2b91932ac0aba5fc3be4247e9a9d68ff05c0136929f7ef203af579cda1b2d9190\" + \"6fc667d50ecd307e2cd3317636a757e00a27a3992fb01556669142c8f2f2bdc32d7f9f349de32\" + \"a2afc2f7e25e3834b2390355d521a3fa3a2ba1e14c235710583b6ed0f4f2aada16ceaf43a75d0\";\n\nvar NetworkMap =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(NetworkMap, _React$Component);\n\n  function NetworkMap() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NetworkMap);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NetworkMap)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      annotId: \"\",\n      visible: false,\n      preTag: \"\",\n      nodeId: \"\",\n      incontext: \"\",\n      backMap: _this.props.backMap,\n      newState: \"\",\n      reload: true,\n      reloadPage: true\n    };\n\n    _this.handleSidebarHide = function () {\n      return _this.setState({\n        visible: false\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(NetworkMap, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this2 = this;\n\n      // console.log(\"pass tag here:\", this.props.passTag);\n      // console.log(\"show me\", this.props.searchedAnnots.data);\n      var selectedTag = this.props.passTag; // const backMap = this.props.backMap;\n\n      var timeFilter = this.props.handleTime;\n      var today = new Date();\n      var fullMonths;\n      var filterArray = this.props.searchedAnnots.data.filter(function (arr) {\n        function monthDiff(d1, today) {\n          d1 = new Date(d1);\n          fullMonths = (today.getFullYear() - d1.getFullYear()) * 12;\n          fullMonths -= d1.getMonth();\n          fullMonths += today.getMonth();\n          return fullMonths <= 0 ? 0 : fullMonths;\n        }\n\n        if (timeFilter === \"oneMonth\") {\n          return monthDiff(arr.created, today) === 0 || monthDiff(arr.created, today) === 1;\n        } else if (timeFilter === \"sixMonths\") {\n          return monthDiff(arr.created, today) <= 6;\n        } else if (timeFilter === \"oneYear\") {\n          return monthDiff(arr.created, today) <= 12;\n        } else if (timeFilter === \"\" || \"all\") {\n          return _this2.props.searchedAnnots.data;\n        }\n      });\n      var array = filterArray.filter(function (arr) {\n        return arr.references === undefined;\n      });\n      console.log(\"array:\", array); // Image & link display\n\n      var self = this;\n\n      function displayImgLink(chartData) {\n        if (self.state.reload) {\n          for (var i = 0; i < chartData.length; i++) {\n            var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n            var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n\n            if (chartData[i].text.match(urls) && !chartData[i].text.match(imgs)) {\n              console.log(\"look! have url and image!\", chartData[i].text);\n\n              if (chartData[i].text.includes(\"a href\")) {\n                chartData[i].text = chartData[i].text.replace(/<a href=/gi, '<a target=\"_blank\" href=');\n              } else if (chartData[i].text.includes(\"iframe\")) {\n                console.log(\"iframe:\", chartData[i].text);\n              } else {\n                chartData[i].text = chartData[i].text.replace(urls, '<a href=\"$1\" target=\"_blank\">$1</a>');\n              }\n            } else if (chartData[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n              var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n              chartData[i].text = chartData[i].text.replace(\"![]\", \"\").replace(/[()]/g, \"\").replace(regex, '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>');\n              var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n\n              if (chartData[i].text.match(nonImgUrl)) {\n                if (chartData[i].text.includes(\"a href\")) {\n                  chartData[i].text = chartData[i].text.replace(nonImgUrl, '<a target=\"_blank\" href=');\n                } else if (chartData[i].text.includes(\"iframe\")) {\n                  console.log(\"iframe:\", chartData[i].text);\n                } else {\n                  chartData[i].text = chartData[i].text.replace(nonImgUrl, '<a href=\"$1\" target=\"_blank\">$1</a>');\n                }\n              }\n            }\n\n            if (i === chartData.length - 1) {\n              console.log(\"hahahhahaha:\", i);\n              self.setState({\n                reload: false\n              });\n            }\n          }\n        }\n      }\n\n      function displayImgLinkPage(chartDataPage) {\n        if (self.state.reloadPage) {\n          for (var i = 0; i < chartDataPage.length; i++) {\n            var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n            var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n\n            if (chartDataPage[i].text.match(urls) && !chartDataPage[i].text.match(imgs)) {\n              console.log(\"look! have url and image!\", chartDataPage[i].text);\n\n              if (chartDataPage[i].text.includes(\"a href\")) {\n                chartDataPage[i].text = chartDataPage[i].text.replace(/<a href=/gi, '<a target=\"_blank\" href=');\n              } else if (chartDataPage[i].text.includes(\"iframe\")) {\n                console.log(\"iframe:\", chartDataPage[i].text);\n              } else {\n                chartDataPage[i].text = chartDataPage[i].text.replace(urls, '<a href=\"$1\" target=\"_blank\">$1</a>');\n              }\n            } else if (chartDataPage[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n              var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n              chartDataPage[i].text = chartDataPage[i].text.replace(\"![]\", \"\").replace(/[()]/g, \"\").replace(regex, '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>');\n              var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n\n              if (chartDataPage[i].text.match(nonImgUrl)) {\n                if (chartDataPage[i].text.includes(\"a href\")) {\n                  chartDataPage[i].text = chartDataPage[i].text.replace(nonImgUrl, '<a target=\"_blank\" href=');\n                } else if (chartDataPage[i].text.includes(\"iframe\")) {\n                  console.log(\"iframe:\", chartDataPage[i].text);\n                } else {\n                  chartDataPage[i].text = chartDataPage[i].text.replace(nonImgUrl, '<a href=\"$1\" target=\"_blank\">$1</a>');\n                }\n              }\n            }\n\n            if (i === chartDataPage.length - 1) {\n              console.log(\"hahahhahaha:\", i);\n              self.setState({\n                reloadPage: false\n              });\n            }\n          }\n        }\n      } // if (self.state.reload) {\n      //   for (var i = 0; i < array.length; i++) {\n      //     var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n      //     var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n      //     if (array[i].text.match(urls) && !array[i].text.match(imgs)) {\n      //       console.log(\"look! have url and image!\", array[i].text);\n      //       if (array[i].text.includes(\"a href\")) {\n      //         array[i].text = array[i].text.replace(\n      //           /<a href=/gi,\n      //           '<a target=\"_blank\" href='\n      //         );\n      //       } else if (array[i].text.includes(\"iframe\")) {\n      //         console.log(\"iframe:\", array[i].text);\n      //       } else {\n      //         array[i].text = array[i].text.replace(\n      //           urls,\n      //           '<a href=\"$1\" target=\"_blank\">$1</a>'\n      //         );\n      //       }\n      //     } else if (array[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n      //       var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n      //       array[i].text = array[i].text\n      //         .replace(\"![]\", \"\")\n      //         .replace(/[()]/g, \"\")\n      //         .replace(\n      //           regex,\n      //           '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>'\n      //         );\n      //       var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n      //       if (array[i].text.match(nonImgUrl)) {\n      //         if (array[i].text.includes(\"a href\")) {\n      //           array[i].text = array[i].text.replace(\n      //             nonImgUrl,\n      //             '<a target=\"_blank\" href='\n      //           );\n      //         } else if (array[i].text.includes(\"iframe\")) {\n      //           console.log(\"iframe:\", array[i].text);\n      //         } else {\n      //           array[i].text = array[i].text.replace(\n      //             nonImgUrl,\n      //             '<a href=\"$1\" target=\"_blank\">$1</a>'\n      //           );\n      //         }\n      //       }\n      //     }\n      //     if (i === array.length - 1) {\n      //       console.log(\"hahahhahaha:\", i);\n      //       self.setState({\n      //         reload: false\n      //       });\n      //     }\n      //   }\n      // }\n      // console.log(\"this is the new array\", array);\n\n\n      var pageArray = this.props.searchedAnnots.Pagedata.filter(function (arr) {\n        return arr.references === undefined;\n      });\n      console.log(\"new annots for the page\", pageArray);\n      displayImgLink(array);\n      displayImgLinkPage(pageArray); // Fake data for test\n\n      var testData = {\n        nodes: [{\n          id: \"A0N0U0C0\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        }, {\n          id: \"A0N1U1C1\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        }, {\n          id: \"A0N2U2C2\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        }],\n        links: [{\n          id: \"LNUC0\",\n          from: \"A0N0U0C0\",\n          to: this.state.nodeId\n        }, {\n          id: \"LNUC1\",\n          from: \"A0N1U1C1\",\n          to: this.state.nodeId\n        }, {\n          id: \"LNUC2\",\n          from: \"A0N2U2C2\",\n          to: this.state.nodeId\n        }]\n      }; // const pageAnnots = this.props.pageAnnots;\n      // if (pageAnnots.length !== 0) {\n      //   console.log(\"all annots on page!!\", pageAnnots);\n      // }\n\n      var annotArray = array.map(function (arr) {\n        return {\n          annotId: arr.id,\n          created: arr.created,\n          document: arr.document,\n          // links: arr.links,\n          tags: arr.tags,\n          target: arr.target,\n          text: arr.text,\n          uri: arr.uri,\n          incontext: arr.links.incontext,\n          user: arr.user.substring(arr.user.indexOf(\":\") + 1, arr.user.indexOf(\"@\"))\n        };\n      }); // console.log(\"no references:\", annotArray);\n\n      var arrayModify = annotArray.reduce(function (o, cur) {\n        var occurs = o.reduce(function (n, item, i) {\n          return item.user === cur.user ? i : n;\n        }, -1);\n\n        if (occurs >= 0) {\n          o[occurs].text = o[occurs].text.concat(cur.text);\n          o[occurs].annotId = o[occurs].annotId.concat(cur.annotId);\n          o[occurs].uri = o[occurs].uri.concat(cur.uri);\n          o[occurs].incontext = o[occurs].incontext.concat(cur.incontext);\n        } else {\n          var obj = {\n            user: cur.user,\n            text: [cur.text],\n            annotId: [cur.annotId],\n            uri: [cur.uri],\n            incontext: [cur.incontext]\n          };\n          o = o.concat([obj]);\n        }\n\n        return o;\n      }, []); // console.log(\"same user array:\", arrayModify);\n      // Annots on the same page\n\n      var pageAnnotArray = pageArray.map(function (arr) {\n        return {\n          annotId: arr.id,\n          created: arr.created,\n          document: arr.document,\n          // links: arr.links,\n          tags: arr.tags,\n          target: arr.target,\n          text: arr.text,\n          uri: arr.uri,\n          incontext: arr.links.incontext,\n          user: arr.user.substring(arr.user.indexOf(\":\") + 1, arr.user.indexOf(\"@\"))\n        };\n      });\n      var pageArrayModify = pageAnnotArray.reduce(function (o, cur) {\n        var occurs = o.reduce(function (n, item, i) {\n          return item.user === cur.user ? i : n;\n        }, -1);\n\n        if (occurs >= 0) {\n          o[occurs].text = o[occurs].text.concat(cur.text);\n          o[occurs].annotId = o[occurs].annotId.concat(cur.annotId); // o[occurs].uri = o[occurs].uri.concat(cur.uri);\n          // o[occurs].incontext = o[occurs].incontext.concat(cur.incontext);\n        } else {\n          var obj = {\n            user: cur.user,\n            text: [cur.text],\n            annotId: [cur.annotId] // uri: [cur.uri],\n            // incontext: [cur.incontext]\n\n          };\n          o = o.concat([obj]);\n        }\n\n        return o;\n      }, []);\n      var newNodesM = [];\n      var newNodesT = [];\n      var newNodesF = [];\n      var newLinksM = [];\n      var newLinksT = [];\n      var newLinksF = [];\n      var newNodesP = [];\n      var newNodesA = []; // const newNodesG = [];\n\n      var newLinksP = [];\n      var newLinksA = []; // const newlinksG = [];\n      // nodes data\n\n      for (var i = 0; i < arrayModify.length; i++) {\n        newNodesM.push({\n          id: \"A\" + i,\n          style: {\n            label: arrayModify[i].user,\n            fillColor: \"#65BCF8\",\n            lineColor: \"rgba(89, 168, 223, 0.5)\"\n          },\n          user: true,\n          loaded: true\n        });\n      }\n\n      var newNodesMM = [{\n        id: \"T\",\n        style: {\n          label: selectedTag,\n          fillColor: \"#912F40\",\n          lineColor: \"rgba(171, 25, 39, 0.5)\"\n        },\n        loaded: true\n      }].concat(newNodesM);\n\n      for (var j = 0; j < arrayModify.length; j++) {\n        if (arrayModify[j].text.length > 1) {\n          for (var k = 0; k < arrayModify[j].text.length; k++) {\n            newNodesT.push({\n              id: \"A\" + j + \"N\" + k,\n              style: {\n                label: arrayModify[j].text[k],\n                fillColor: \"#68CF9D\",\n                lineColor: \"rgba(98, 188, 144, 0.5)\"\n              },\n              annotId: arrayModify[j].annotId[k],\n              loaded: true,\n              multiple: \"yes\"\n            });\n            newNodesF.push({\n              id: \"A\" + j + \"N\" + k + \"U\" + k,\n              style: {\n                label: arrayModify[j].uri[k],\n                fillColor: \"#ffd86e\",\n                lineColor: \"#F4C230\",\n                lineDash: [10, 5, 2, 5],\n                lineWidth: 2\n              },\n              incontext: arrayModify[j].incontext[k],\n              loaded: true,\n              multiple: \"yes\"\n            });\n          }\n        } else {\n          newNodesT.push({\n            id: \"A\" + j + \"N\" + j,\n            style: {\n              label: arrayModify[j].text[0],\n              fillColor: \"#68CF9D\",\n              lineColor: \"rgba(98, 188, 144, 0.5)\"\n            },\n            annotId: arrayModify[j].annotId[0],\n            loaded: true\n          });\n          newNodesF.push({\n            id: \"A\" + j + \"N\" + j + \"U\" + j,\n            style: {\n              label: arrayModify[j].uri[0],\n              fillColor: \"#ffd86e\",\n              lineColor: \"#F4C230\",\n              lineDash: [10, 5, 2, 5],\n              lineWidth: 2\n            },\n            incontext: arrayModify[j].incontext[0],\n            loaded: true\n          });\n        }\n      } // Annots on the same page -- nodes data\n\n\n      for (var i = 0; i < pageArrayModify.length; i++) {\n        newNodesP.push({\n          id: \"C\" + i,\n          style: {\n            label: pageArrayModify[i].user,\n            fillColor: \"#65BCF8\",\n            lineColor: \"rgba(89, 168, 223, 0.5)\"\n          },\n          user: true,\n          loaded: true\n        });\n      }\n\n      for (var j = 0; j < pageArrayModify.length; j++) {\n        if (pageArrayModify[j].text.length > 1) {\n          for (var k = 0; k < pageArrayModify[j].text.length; k++) {\n            newNodesA.push({\n              id: \"C\" + j + \"NN\" + k,\n              style: {\n                label: pageArrayModify[j].text[k],\n                fillColor: \"#68CF9D\",\n                lineColor: \"rgba(98, 188, 144, 0.5)\"\n              },\n              annotId: pageArrayModify[j].annotId[k],\n              loaded: true,\n              multiple: \"yes\"\n            });\n          }\n        } else {\n          newNodesA.push({\n            id: \"C\" + j + \"NN\" + j,\n            style: {\n              label: pageArrayModify[j].text[0],\n              fillColor: \"#68CF9D\",\n              lineColor: \"rgba(98, 188, 144, 0.5)\"\n            },\n            annotId: pageArrayModify[j].annotId[0],\n            loaded: true\n          });\n        }\n      }\n\n      var newNodes = newNodesMM.concat(newNodesT, newNodesF, newNodesP, newNodesA); // console.log(\"newNodes\", newNodes);\n      // links data\n\n      for (var i = 0; i < newNodesM.length; i++) {\n        newLinksM.push({\n          id: \"L\" + i,\n          from: newNodesM[i].id,\n          to: \"T\",\n          type: \"creators\"\n        });\n      }\n\n      for (var i = 0; i < newNodesT.length; i++) {\n        newLinksT.push({\n          id: \"LN\" + i,\n          from: newNodesT[i].id,\n          to: newNodesT[i].id.substring(newNodesT[i].id.indexOf(\"A\"), newNodesT[i].id.indexOf(\"N\")),\n          type: \"annots\"\n        });\n        newLinksF.push({\n          id: \"LNU\" + i,\n          from: newNodesF[i].id,\n          to: newNodesF[i].id.substring(newNodesF[i].id.indexOf(\"A\"), newNodesF[i].id.indexOf(\"U\")),\n          type: \"uri\"\n        });\n      } // Annots on the same page -- links data\n\n\n      for (var i = 0; i < newNodesP.length; i++) {\n        newLinksP.push({\n          id: \"LL\" + i,\n          from: newNodesP[i].id,\n          to: this.state.nodeId,\n          type: \"creators\"\n        });\n      }\n\n      for (var i = 0; i < newNodesA.length; i++) {\n        newLinksA.push({\n          id: \"LNN\" + i,\n          from: newNodesA[i].id,\n          to: newNodesA[i].id.substring(newNodesA[i].id.indexOf(\"C\"), newNodesA[i].id.indexOf(\"NN\")),\n          type: \"annots\"\n        });\n      }\n\n      var newLinks = newLinksM.concat(newLinksT, newLinksF, newLinksP, newLinksA); // console.log(\"newLinks\", newLinks);\n\n      var self = this;\n      var selfProps = this.props;\n\n      if (selectedTag !== \"\") {\n        var nodeStyle = function nodeStyle(node) {\n          if (node.hovered) {\n            node.radius = 38;\n\n            if (node.data === undefined) {\n              return;\n            } else if (node.data.id.indexOf(\"N\") !== -1 && node.data.id.indexOf(\"U\") === -1) {\n              node.items = [{\n                text: \"ANNOTATION\",\n                backgroundStyle: {\n                  fillColor: \"rgba(98, 188, 144, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: {\n                  fillColor: \"white\"\n                },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }];\n            } else if (node.data.id.indexOf(\"N\") === -1 && node.data.id !== \"T\" || node.data.id.indexOf(\"C\") !== -1) {\n              node.items = [{\n                text: \"USER\",\n                backgroundStyle: {\n                  fillColor: \"rgba(89, 168, 223, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: {\n                  fillColor: \"white\"\n                },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }];\n            } else if (node.data.id === \"T\") {\n              node.items = [{\n                text: \"TAG\",\n                backgroundStyle: {\n                  fillColor: \"rgba(171, 25, 39, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: {\n                  fillColor: \"white\"\n                },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }];\n            } else if (node.data.id.indexOf(\"U\") !== -1) {\n              node.items = [{\n                text: \"WEB PAGE\",\n                backgroundStyle: {\n                  fillColor: \"rgba(255,216,110,0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: {\n                  fillColor: \"white\"\n                },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }];\n            }\n          } else {\n            node.radius = 30;\n            node.items = [{\n              text: \"aaa\",\n              textStyle: {\n                fillColor: \"transparent\"\n              },\n              backgroundStyle: {\n                fillColor: \"transparent\",\n                lineColor: \"transparent\"\n              }\n            }];\n          }\n        };\n\n        var linkStyle = function linkStyle(link) {\n          if (link.hovered) {\n            link.radius = 2;\n            link.fillColor = \"#979797\";\n            link.shadowColor = \"#979797\";\n          } else {\n            link.radius = 1;\n            link.fillColor = \"#D8D8D8\";\n          }\n        };\n\n        var graphDoubleClick = function graphDoubleClick(event) {\n          event.preventDefault(); // console.log(\"event data:\", event.clickNode.data);\n          // console.log(\"tell me double\", event.clickNode);\n\n          if (event.clickNode === undefined) {\n            return;\n          } else if (event.clickNode.data.annotId) {\n            self.setState({\n              annotId: event.clickNode.data.annotId,\n              visible: true,\n              preTag: selectedTag\n            }); // save and restore state\n\n            setTimeout(function () {\n              var state = t.saveState();\n              self.setState({\n                newState: state\n              }, function () {\n                console.log(\"update state:\", self.state.newState);\n              });\n            }, 0);\n            console.log(\"check state:\", t.saveState());\n            console.log(\"the state in state\", self.state.newState);\n            selfProps.fetchFullAnnot(event.clickNode.data.annotId);\n          } else if (event.clickNode.data.incontext) {\n            // console.log(\"original page:\", event.clickNode.data.incontext);\n            window.open(event.clickNode.data.incontext);\n          } else if (event.clickNode.data.user) {\n            window.open(\"https://hypothes.is/users/\" + event.clickNode.data.style.label);\n          }\n        };\n\n        var graghClick = function graghClick(event) {\n          if (event.clickNode === undefined) {\n            return;\n          } else if (event.clickNode.data.incontext && event.clickNode.data.incontext !== self.state.incontext) {\n            // console.log(\"search annot on this page:\", event.clickNode.data);\n            self.setState({\n              nodeId: event.clickNode.data.id,\n              incontext: event.clickNode.data.incontext,\n              backMap: true,\n              preTag: selectedTag\n            }); // save and restore state\n\n            setTimeout(function () {\n              var linkState = t.saveState();\n              self.setState({\n                newState: linkState\n              });\n            }, 0);\n            selfProps.fetchPageAnnots(event.clickNode.data.style.label);\n          }\n        }; // save and restore state\n        // function restoreNetwork(s) {\n        //   if (s !== \"\" && selectedTag === self.state.preTag) {\n        //     t.restoreState(s);\n        //   }\n        // }\n\n\n        var t = new Chart({\n          container: document.getElementById(\"chartNetChart\"),\n          area: {\n            style: {\n              fillColor: \"#f9fbfd\"\n            }\n          },\n          navigation: {\n            focusNodeExpansionRadius: 1,\n            initialNodes: [\"T\"],\n            // mode: \"focusnodes\",\n            mode: \"manual\" // autoZoomOnFocus: true\n\n          },\n          layout: {\n            mode: \"dynamic\",\n            nodeSpacing: 30\n          },\n          style: {\n            node: {\n              display: \"roundtext\",\n              lineWidth: 5\n            },\n            nodeStyleFunction: nodeStyle,\n            linkStyleFunction: linkStyle,\n            link: {\n              fillColor: \"#D8D8D8\"\n            },\n            nodeHovered: {\n              shadowBlur: 1\n            },\n            linkHovered: {\n              shadowBlur: 1\n            },\n            nodeLabel: {\n              textStyle: {\n                fillColor: \"white\"\n              }\n            }\n          },\n          selection: {\n            enabled: true\n          },\n          data: {\n            preloaded: {\n              nodes: newNodes,\n              links: newLinks\n            }\n          },\n          events: {\n            onDoubleClick: graphDoubleClick,\n            onClick: graghClick\n          },\n          toolbar: {\n            fullscreen: true,\n            enabled: true\n          },\n          interaction: {\n            resizing: {\n              enabled: false\n            },\n            zooming: {\n              initialAutoZoom: false\n            }\n          }\n        });\n\n        if (self.state.newState !== \"\" && selectedTag === self.state.preTag && !timeFilter) {\n          t.restoreState(self.state.newState);\n        }\n      }\n    }\n  }, {\n    key: \"renderAnnots\",\n    value: function renderAnnots() {\n      if (this.props.passTag == \"\") {\n        return React.createElement(\"div\", {\n          className: \"img-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 876\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          className: \"temp-image\",\n          src: networkIcon,\n          alt: \"network icon\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 877\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          className: \"temp-text\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 878\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"text-color-red\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 879\n          },\n          __self: this\n        }, \"Choose\"), \" or\", \" \", React.createElement(\"span\", {\n          className: \"text-color-blue\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 880\n          },\n          __self: this\n        }, \"Search\"), \" the Tag \", React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 880\n          },\n          __self: this\n        }), \" to Create Your Personal Learning Network\"));\n      }\n    }\n  }, {\n    key: \"renderBack\",\n    value: function renderBack() {\n      var _this3 = this;\n\n      if (this.state.backMap === true) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 891\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          onClick: function onClick() {\n            return _this3.setState({\n              backMap: false\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 892\n          },\n          __self: this\n        }, \"click me and back\"));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var visible = this.state.visible;\n      var annotData = this.props.fullAnnots;\n      return React.createElement(\"div\", {\n        className: \"map-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 904\n        },\n        __self: this\n      }, React.createElement(Sidebar.Pushable, {\n        as: Segment,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 905\n        },\n        __self: this\n      }, React.createElement(Sidebar, {\n        as: Menu,\n        animation: \"overlay\",\n        icon: \"labeled\",\n        inverted: true,\n        onHide: this.handleSidebarHide,\n        vertical: true,\n        visible: visible,\n        width: \"wide\",\n        direction: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 906\n        },\n        __self: this\n      }, React.createElement(AnnotSidebar, {\n        fullAnnots: {\n          annotData: annotData\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 917\n        },\n        __self: this\n      })), React.createElement(Sidebar.Pusher, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 920\n        },\n        __self: this\n      }, React.createElement(Segment, {\n        basic: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 921\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"chartNetChart\",\n        className: \"chart\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 923\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 927\n        },\n        __self: this\n      }, this.renderAnnots())))));\n    }\n  }]);\n\n  return NetworkMap;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    fullAnnots: state.fullAnnot\n  };\n};\n\nexport default connect(mapStateToProps, {\n  fetchFullAnnot: fetchFullAnnot,\n  fetchPageAnnots: fetchPageAnnots\n})(NetworkMap);","map":{"version":3,"sources":["/Users/wchen/Dropbox/UMN/2019_Spring/PLB_Capstone/PLC/PLC/src/components/NetworkMap.js"],"names":["React","networkIcon","zc","AnnotSidebar","connect","fetchFullAnnot","fetchPageAnnots","Menu","Segment","Sidebar","Chart","NetChart","window","ZoomChartsLicense","ZoomChartsLicenseKey","NetworkMap","state","annotId","visible","preTag","nodeId","incontext","backMap","props","newState","reload","reloadPage","handleSidebarHide","setState","selectedTag","passTag","timeFilter","handleTime","today","Date","fullMonths","filterArray","searchedAnnots","data","filter","arr","monthDiff","d1","getFullYear","getMonth","created","array","references","undefined","console","log","self","displayImgLink","chartData","i","length","urls","imgs","text","match","includes","replace","regex","nonImgUrl","displayImgLinkPage","chartDataPage","pageArray","Pagedata","testData","nodes","id","style","label","loaded","links","from","to","annotArray","map","document","tags","target","uri","user","substring","indexOf","arrayModify","reduce","o","cur","occurs","n","item","concat","obj","pageAnnotArray","pageArrayModify","newNodesM","newNodesT","newNodesF","newLinksM","newLinksT","newLinksF","newNodesP","newNodesA","newLinksP","newLinksA","push","fillColor","lineColor","newNodesMM","j","k","multiple","lineDash","lineWidth","newNodes","type","newLinks","selfProps","nodeStyle","node","hovered","radius","items","backgroundStyle","textStyle","px","py","x","y","aspectRatio","scaleWithZoom","scaleWithSize","maxWidth","padding","linkStyle","link","shadowColor","graphDoubleClick","event","preventDefault","clickNode","setTimeout","t","saveState","open","graghClick","linkState","container","getElementById","area","navigation","focusNodeExpansionRadius","initialNodes","mode","layout","nodeSpacing","display","nodeStyleFunction","linkStyleFunction","nodeHovered","shadowBlur","linkHovered","nodeLabel","selection","enabled","preloaded","events","onDoubleClick","onClick","toolbar","fullscreen","interaction","resizing","zooming","initialAutoZoom","restoreState","annotData","fullAnnots","renderAnnots","Component","mapStateToProps","fullAnnot"],"mappings":"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","sourcesContent":["import \"../css/NetworkMap.css\";\nimport React from \"react\";\nimport networkIcon from \"../assets/connection.png\";\nimport zc from \"@dvsl/zoomcharts\";\nimport AnnotSidebar from \"./Sidebar\";\nimport { connect } from \"react-redux\";\nimport { fetchFullAnnot, fetchPageAnnots } from \"../actions\";\n\nimport { Menu, Segment, Sidebar } from \"semantic-ui-react\";\n\nlet Chart = zc.NetChart;\n\n// Zoomcharts license and license key\nwindow.ZoomChartsLicense =\n  \"ZCP-dq3x184y6: ZoomCharts SDK Internal Use license for University of Minnesota. Valid for 1 chart developer and 1 external site license\";\nwindow.ZoomChartsLicenseKey =\n  \"9ecdcfd309df4b4a9bb8ffca5c2f3c0561911045d450c36abc\" +\n  \"65fd86ce49f03a893df118954e43bae3c044def8f1561828f71b123765f399104720eff951e74\" +\n  \"3c7e68f18633262026c2cb4350f0e7cee21923ec226f943df31aa64c1f36c35bf660407fa18ea\" +\n  \"2701c1b52d6576340539a77d626789b65c4d6b66905da423631579634876a14661d2ffd77660b\" +\n  \"43c2ffed1e2d2b91932ac0aba5fc3be4247e9a9d68ff05c0136929f7ef203af579cda1b2d9190\" +\n  \"6fc667d50ecd307e2cd3317636a757e00a27a3992fb01556669142c8f2f2bdc32d7f9f349de32\" +\n  \"a2afc2f7e25e3834b2390355d521a3fa3a2ba1e14c235710583b6ed0f4f2aada16ceaf43a75d0\";\n\nclass NetworkMap extends React.Component {\n  state = {\n    annotId: \"\",\n    visible: false,\n    preTag: \"\",\n    nodeId: \"\",\n    incontext: \"\",\n    backMap: this.props.backMap,\n    newState: \"\",\n    reload: true,\n    reloadPage: true\n  };\n\n  componentDidUpdate() {\n    // console.log(\"pass tag here:\", this.props.passTag);\n    // console.log(\"show me\", this.props.searchedAnnots.data);\n\n    const selectedTag = this.props.passTag;\n    // const backMap = this.props.backMap;\n\n    const timeFilter = this.props.handleTime;\n    const today = new Date();\n    var fullMonths;\n\n    const filterArray = this.props.searchedAnnots.data.filter(arr => {\n      function monthDiff(d1, today) {\n        d1 = new Date(d1);\n        fullMonths = (today.getFullYear() - d1.getFullYear()) * 12;\n        fullMonths -= d1.getMonth();\n        fullMonths += today.getMonth();\n        return fullMonths <= 0 ? 0 : fullMonths;\n      }\n\n      if (timeFilter === \"oneMonth\") {\n        return (\n          monthDiff(arr.created, today) === 0 ||\n          monthDiff(arr.created, today) === 1\n        );\n      } else if (timeFilter === \"sixMonths\") {\n        return monthDiff(arr.created, today) <= 6;\n      } else if (timeFilter === \"oneYear\") {\n        return monthDiff(arr.created, today) <= 12;\n      } else if (timeFilter === \"\" || \"all\") {\n        return this.props.searchedAnnots.data;\n      }\n    });\n\n    var array = filterArray.filter(arr => {\n      return arr.references === undefined;\n    });\n    console.log(\"array:\", array);\n\n    // Image & link display\n    var self = this;\n\n    function displayImgLink(chartData) {\n      if (self.state.reload) {\n        for (var i = 0; i < chartData.length; i++) {\n          var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n          var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n\n          if (chartData[i].text.match(urls) && !chartData[i].text.match(imgs)) {\n            console.log(\"look! have url and image!\", chartData[i].text);\n            if (chartData[i].text.includes(\"a href\")) {\n              chartData[i].text = chartData[i].text.replace(\n                /<a href=/gi,\n                '<a target=\"_blank\" href='\n              );\n            } else if (chartData[i].text.includes(\"iframe\")) {\n              console.log(\"iframe:\", chartData[i].text);\n            } else {\n              chartData[i].text = chartData[i].text.replace(\n                urls,\n                '<a href=\"$1\" target=\"_blank\">$1</a>'\n              );\n            }\n          } else if (chartData[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n            var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n            chartData[i].text = chartData[i].text\n              .replace(\"![]\", \"\")\n              .replace(/[()]/g, \"\")\n              .replace(\n                regex,\n                '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>'\n              );\n            var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n            if (chartData[i].text.match(nonImgUrl)) {\n              if (chartData[i].text.includes(\"a href\")) {\n                chartData[i].text = chartData[i].text.replace(\n                  nonImgUrl,\n                  '<a target=\"_blank\" href='\n                );\n              } else if (chartData[i].text.includes(\"iframe\")) {\n                console.log(\"iframe:\", chartData[i].text);\n              } else {\n                chartData[i].text = chartData[i].text.replace(\n                  nonImgUrl,\n                  '<a href=\"$1\" target=\"_blank\">$1</a>'\n                );\n              }\n            }\n          }\n          if (i === chartData.length - 1) {\n            console.log(\"hahahhahaha:\", i);\n            self.setState({\n              reload: false\n            });\n          }\n        }\n      }\n    }\n\n    function displayImgLinkPage(chartDataPage) {\n      if (self.state.reloadPage) {\n        for (var i = 0; i < chartDataPage.length; i++) {\n          var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n          var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n\n          if (\n            chartDataPage[i].text.match(urls) &&\n            !chartDataPage[i].text.match(imgs)\n          ) {\n            console.log(\"look! have url and image!\", chartDataPage[i].text);\n            if (chartDataPage[i].text.includes(\"a href\")) {\n              chartDataPage[i].text = chartDataPage[i].text.replace(\n                /<a href=/gi,\n                '<a target=\"_blank\" href='\n              );\n            } else if (chartDataPage[i].text.includes(\"iframe\")) {\n              console.log(\"iframe:\", chartDataPage[i].text);\n            } else {\n              chartDataPage[i].text = chartDataPage[i].text.replace(\n                urls,\n                '<a href=\"$1\" target=\"_blank\">$1</a>'\n              );\n            }\n          } else if (chartDataPage[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n            var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n            chartDataPage[i].text = chartDataPage[i].text\n              .replace(\"![]\", \"\")\n              .replace(/[()]/g, \"\")\n              .replace(\n                regex,\n                '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>'\n              );\n            var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n            if (chartDataPage[i].text.match(nonImgUrl)) {\n              if (chartDataPage[i].text.includes(\"a href\")) {\n                chartDataPage[i].text = chartDataPage[i].text.replace(\n                  nonImgUrl,\n                  '<a target=\"_blank\" href='\n                );\n              } else if (chartDataPage[i].text.includes(\"iframe\")) {\n                console.log(\"iframe:\", chartDataPage[i].text);\n              } else {\n                chartDataPage[i].text = chartDataPage[i].text.replace(\n                  nonImgUrl,\n                  '<a href=\"$1\" target=\"_blank\">$1</a>'\n                );\n              }\n            }\n          }\n          if (i === chartDataPage.length - 1) {\n            console.log(\"hahahhahaha:\", i);\n            self.setState({\n              reloadPage: false\n            });\n          }\n        }\n      }\n    }\n\n    // if (self.state.reload) {\n    //   for (var i = 0; i < array.length; i++) {\n    //     var urls = /(\\b(https?|ftp):\\/\\/[A-Z0-9+&@#\\/%?=~_|!:,.;-]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n    //     var imgs = /(https?:\\/\\/.*\\.(?:jpeg|jpg|png|gif))/i;\n\n    //     if (array[i].text.match(urls) && !array[i].text.match(imgs)) {\n    //       console.log(\"look! have url and image!\", array[i].text);\n    //       if (array[i].text.includes(\"a href\")) {\n    //         array[i].text = array[i].text.replace(\n    //           /<a href=/gi,\n    //           '<a target=\"_blank\" href='\n    //         );\n    //       } else if (array[i].text.includes(\"iframe\")) {\n    //         console.log(\"iframe:\", array[i].text);\n    //       } else {\n    //         array[i].text = array[i].text.replace(\n    //           urls,\n    //           '<a href=\"$1\" target=\"_blank\">$1</a>'\n    //         );\n    //       }\n    //     } else if (array[i].text.match(/\\.(jpeg|jpg|png|gif)/g)) {\n    //       var regex = /(https?:\\/\\/.*\\.(?:png|jpg))/i;\n    //       array[i].text = array[i].text\n    //         .replace(\"![]\", \"\")\n    //         .replace(/[()]/g, \"\")\n    //         .replace(\n    //           regex,\n    //           '<img src=\"$1\" width=\"50%\" style=\"margin-bottom: 0.2rem; margin-top: 0.2rem; margin-left: auto; margin-right: auto; float: none; display: block\"></img>'\n    //         );\n    //       var nonImgUrl = /(?:^|[^\"'])((ftp|http|https|file):\\/\\/[\\S]+(\\b|$))/gim;\n    //       if (array[i].text.match(nonImgUrl)) {\n    //         if (array[i].text.includes(\"a href\")) {\n    //           array[i].text = array[i].text.replace(\n    //             nonImgUrl,\n    //             '<a target=\"_blank\" href='\n    //           );\n    //         } else if (array[i].text.includes(\"iframe\")) {\n    //           console.log(\"iframe:\", array[i].text);\n    //         } else {\n    //           array[i].text = array[i].text.replace(\n    //             nonImgUrl,\n    //             '<a href=\"$1\" target=\"_blank\">$1</a>'\n    //           );\n    //         }\n    //       }\n    //     }\n    //     if (i === array.length - 1) {\n    //       console.log(\"hahahhahaha:\", i);\n    //       self.setState({\n    //         reload: false\n    //       });\n    //     }\n    //   }\n    // }\n\n    // console.log(\"this is the new array\", array);\n\n    const pageArray = this.props.searchedAnnots.Pagedata.filter(arr => {\n      return arr.references === undefined;\n    });\n    console.log(\"new annots for the page\", pageArray);\n\n    displayImgLink(array);\n    displayImgLinkPage(pageArray);\n\n    // Fake data for test\n    var testData = {\n      nodes: [\n        {\n          id: \"A0N0U0C0\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        },\n        {\n          id: \"A0N1U1C1\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        },\n        {\n          id: \"A0N2U2C2\",\n          style: {\n            label: \"under development\"\n          },\n          loaded: true\n        }\n      ],\n      links: [\n        {\n          id: \"LNUC0\",\n          from: \"A0N0U0C0\",\n          to: this.state.nodeId\n        },\n        {\n          id: \"LNUC1\",\n          from: \"A0N1U1C1\",\n          to: this.state.nodeId\n        },\n        {\n          id: \"LNUC2\",\n          from: \"A0N2U2C2\",\n          to: this.state.nodeId\n        }\n      ]\n    };\n\n    // const pageAnnots = this.props.pageAnnots;\n    // if (pageAnnots.length !== 0) {\n    //   console.log(\"all annots on page!!\", pageAnnots);\n    // }\n\n    const annotArray = array.map(arr => {\n      return {\n        annotId: arr.id,\n        created: arr.created,\n        document: arr.document,\n        // links: arr.links,\n        tags: arr.tags,\n        target: arr.target,\n        text: arr.text,\n        uri: arr.uri,\n        incontext: arr.links.incontext,\n        user: arr.user.substring(\n          arr.user.indexOf(\":\") + 1,\n          arr.user.indexOf(\"@\")\n        )\n      };\n    });\n    // console.log(\"no references:\", annotArray);\n\n    const arrayModify = annotArray.reduce((o, cur) => {\n      var occurs = o.reduce((n, item, i) => {\n        return item.user === cur.user ? i : n;\n      }, -1);\n      if (occurs >= 0) {\n        o[occurs].text = o[occurs].text.concat(cur.text);\n        o[occurs].annotId = o[occurs].annotId.concat(cur.annotId);\n        o[occurs].uri = o[occurs].uri.concat(cur.uri);\n        o[occurs].incontext = o[occurs].incontext.concat(cur.incontext);\n      } else {\n        var obj = {\n          user: cur.user,\n          text: [cur.text],\n          annotId: [cur.annotId],\n          uri: [cur.uri],\n          incontext: [cur.incontext]\n        };\n        o = o.concat([obj]);\n      }\n      return o;\n    }, []);\n\n    // console.log(\"same user array:\", arrayModify);\n\n    // Annots on the same page\n    const pageAnnotArray = pageArray.map(arr => {\n      return {\n        annotId: arr.id,\n        created: arr.created,\n        document: arr.document,\n        // links: arr.links,\n        tags: arr.tags,\n        target: arr.target,\n        text: arr.text,\n        uri: arr.uri,\n        incontext: arr.links.incontext,\n        user: arr.user.substring(\n          arr.user.indexOf(\":\") + 1,\n          arr.user.indexOf(\"@\")\n        )\n      };\n    });\n\n    const pageArrayModify = pageAnnotArray.reduce((o, cur) => {\n      var occurs = o.reduce((n, item, i) => {\n        return item.user === cur.user ? i : n;\n      }, -1);\n      if (occurs >= 0) {\n        o[occurs].text = o[occurs].text.concat(cur.text);\n        o[occurs].annotId = o[occurs].annotId.concat(cur.annotId);\n        // o[occurs].uri = o[occurs].uri.concat(cur.uri);\n        // o[occurs].incontext = o[occurs].incontext.concat(cur.incontext);\n      } else {\n        var obj = {\n          user: cur.user,\n          text: [cur.text],\n          annotId: [cur.annotId]\n          // uri: [cur.uri],\n          // incontext: [cur.incontext]\n        };\n        o = o.concat([obj]);\n      }\n      return o;\n    }, []);\n\n    const newNodesM = [];\n    const newNodesT = [];\n    const newNodesF = [];\n\n    const newLinksM = [];\n    const newLinksT = [];\n    const newLinksF = [];\n\n    const newNodesP = [];\n    const newNodesA = [];\n    // const newNodesG = [];\n\n    const newLinksP = [];\n    const newLinksA = [];\n    // const newlinksG = [];\n\n    // nodes data\n    for (var i = 0; i < arrayModify.length; i++) {\n      newNodesM.push({\n        id: \"A\" + i,\n        style: {\n          label: arrayModify[i].user,\n          fillColor: \"#65BCF8\",\n          lineColor: \"rgba(89, 168, 223, 0.5)\"\n        },\n        user: true,\n        loaded: true\n      });\n    }\n\n    var newNodesMM = [\n      {\n        id: \"T\",\n        style: {\n          label: selectedTag,\n          fillColor: \"#912F40\",\n          lineColor: \"rgba(171, 25, 39, 0.5)\"\n        },\n        loaded: true\n      },\n      ...newNodesM\n    ];\n\n    for (var j = 0; j < arrayModify.length; j++) {\n      if (arrayModify[j].text.length > 1) {\n        for (var k = 0; k < arrayModify[j].text.length; k++) {\n          newNodesT.push({\n            id: \"A\" + j + \"N\" + k,\n            style: {\n              label: arrayModify[j].text[k],\n              fillColor: \"#68CF9D\",\n\n              lineColor: \"rgba(98, 188, 144, 0.5)\"\n            },\n            annotId: arrayModify[j].annotId[k],\n            loaded: true,\n            multiple: \"yes\"\n          });\n          newNodesF.push({\n            id: \"A\" + j + \"N\" + k + \"U\" + k,\n            style: {\n              label: arrayModify[j].uri[k],\n              fillColor: \"#ffd86e\",\n              lineColor: \"#F4C230\",\n              lineDash: [10, 5, 2, 5],\n              lineWidth: 2\n            },\n            incontext: arrayModify[j].incontext[k],\n            loaded: true,\n            multiple: \"yes\"\n          });\n        }\n      } else {\n        newNodesT.push({\n          id: \"A\" + j + \"N\" + j,\n          style: {\n            label: arrayModify[j].text[0],\n            fillColor: \"#68CF9D\",\n\n            lineColor: \"rgba(98, 188, 144, 0.5)\"\n          },\n          annotId: arrayModify[j].annotId[0],\n\n          loaded: true\n        });\n        newNodesF.push({\n          id: \"A\" + j + \"N\" + j + \"U\" + j,\n          style: {\n            label: arrayModify[j].uri[0],\n            fillColor: \"#ffd86e\",\n            lineColor: \"#F4C230\",\n            lineDash: [10, 5, 2, 5],\n            lineWidth: 2\n          },\n          incontext: arrayModify[j].incontext[0],\n          loaded: true\n        });\n      }\n    }\n\n    // Annots on the same page -- nodes data\n    for (var i = 0; i < pageArrayModify.length; i++) {\n      newNodesP.push({\n        id: \"C\" + i,\n        style: {\n          label: pageArrayModify[i].user,\n          fillColor: \"#65BCF8\",\n          lineColor: \"rgba(89, 168, 223, 0.5)\"\n        },\n        user: true,\n        loaded: true\n      });\n    }\n\n    for (var j = 0; j < pageArrayModify.length; j++) {\n      if (pageArrayModify[j].text.length > 1) {\n        for (var k = 0; k < pageArrayModify[j].text.length; k++) {\n          newNodesA.push({\n            id: \"C\" + j + \"NN\" + k,\n            style: {\n              label: pageArrayModify[j].text[k],\n              fillColor: \"#68CF9D\",\n              lineColor: \"rgba(98, 188, 144, 0.5)\"\n            },\n            annotId: pageArrayModify[j].annotId[k],\n            loaded: true,\n            multiple: \"yes\"\n          });\n        }\n      } else {\n        newNodesA.push({\n          id: \"C\" + j + \"NN\" + j,\n          style: {\n            label: pageArrayModify[j].text[0],\n            fillColor: \"#68CF9D\",\n            lineColor: \"rgba(98, 188, 144, 0.5)\"\n          },\n          annotId: pageArrayModify[j].annotId[0],\n          loaded: true\n        });\n      }\n    }\n\n    const newNodes = newNodesMM.concat(\n      newNodesT,\n      newNodesF,\n      newNodesP,\n      newNodesA\n    );\n    // console.log(\"newNodes\", newNodes);\n\n    // links data\n    for (var i = 0; i < newNodesM.length; i++) {\n      newLinksM.push({\n        id: \"L\" + i,\n        from: newNodesM[i].id,\n        to: \"T\",\n        type: \"creators\"\n      });\n    }\n\n    for (var i = 0; i < newNodesT.length; i++) {\n      newLinksT.push({\n        id: \"LN\" + i,\n        from: newNodesT[i].id,\n        to: newNodesT[i].id.substring(\n          newNodesT[i].id.indexOf(\"A\"),\n          newNodesT[i].id.indexOf(\"N\")\n        ),\n        type: \"annots\"\n      });\n      newLinksF.push({\n        id: \"LNU\" + i,\n        from: newNodesF[i].id,\n        to: newNodesF[i].id.substring(\n          newNodesF[i].id.indexOf(\"A\"),\n          newNodesF[i].id.indexOf(\"U\")\n        ),\n        type: \"uri\"\n      });\n    }\n\n    // Annots on the same page -- links data\n    for (var i = 0; i < newNodesP.length; i++) {\n      newLinksP.push({\n        id: \"LL\" + i,\n        from: newNodesP[i].id,\n        to: this.state.nodeId,\n        type: \"creators\"\n      });\n    }\n\n    for (var i = 0; i < newNodesA.length; i++) {\n      newLinksA.push({\n        id: \"LNN\" + i,\n        from: newNodesA[i].id,\n        to: newNodesA[i].id.substring(\n          newNodesA[i].id.indexOf(\"C\"),\n          newNodesA[i].id.indexOf(\"NN\")\n        ),\n        type: \"annots\"\n      });\n    }\n\n    var newLinks = newLinksM.concat(newLinksT, newLinksF, newLinksP, newLinksA);\n    // console.log(\"newLinks\", newLinks);\n\n    var self = this;\n    var selfProps = this.props;\n\n    if (selectedTag !== \"\") {\n      var t = new Chart({\n        container: document.getElementById(\"chartNetChart\"),\n        area: {\n          style: { fillColor: \"#f9fbfd\" }\n        },\n        navigation: {\n          focusNodeExpansionRadius: 1,\n          initialNodes: [\"T\"],\n          // mode: \"focusnodes\",\n          mode: \"manual\"\n          // autoZoomOnFocus: true\n        },\n        layout: {\n          mode: \"dynamic\",\n          nodeSpacing: 30\n        },\n        style: {\n          node: {\n            display: \"roundtext\",\n            lineWidth: 5\n          },\n          nodeStyleFunction: nodeStyle,\n          linkStyleFunction: linkStyle,\n          link: {\n            fillColor: \"#D8D8D8\"\n          },\n          nodeHovered: {\n            shadowBlur: 1\n          },\n          linkHovered: {\n            shadowBlur: 1\n          },\n          nodeLabel: {\n            textStyle: { fillColor: \"white\" }\n          }\n        },\n        selection: {\n          enabled: true\n        },\n        data: {\n          preloaded: {\n            nodes: newNodes,\n            links: newLinks\n          }\n        },\n        events: {\n          onDoubleClick: graphDoubleClick,\n          onClick: graghClick\n        },\n        toolbar: {\n          fullscreen: true,\n          enabled: true\n        },\n        interaction: {\n          resizing: {\n            enabled: false\n          },\n          zooming: {\n            initialAutoZoom: false\n          }\n        }\n      });\n\n      function nodeStyle(node) {\n        if (node.hovered) {\n          node.radius = 38;\n          if (node.data === undefined) {\n            return;\n          } else if (\n            node.data.id.indexOf(\"N\") !== -1 &&\n            node.data.id.indexOf(\"U\") === -1\n          ) {\n            node.items = [\n              {\n                text: \"ANNOTATION\",\n                backgroundStyle: {\n                  fillColor: \"rgba(98, 188, 144, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: { fillColor: \"white\" },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }\n            ];\n          } else if (\n            (node.data.id.indexOf(\"N\") === -1 && node.data.id !== \"T\") ||\n            node.data.id.indexOf(\"C\") !== -1\n          ) {\n            node.items = [\n              {\n                text: \"USER\",\n                backgroundStyle: {\n                  fillColor: \"rgba(89, 168, 223, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: { fillColor: \"white\" },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }\n            ];\n          } else if (node.data.id === \"T\") {\n            node.items = [\n              {\n                text: \"TAG\",\n                backgroundStyle: {\n                  fillColor: \"rgba(171, 25, 39, 0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: { fillColor: \"white\" },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }\n            ];\n          } else if (node.data.id.indexOf(\"U\") !== -1) {\n            node.items = [\n              {\n                text: \"WEB PAGE\",\n                backgroundStyle: {\n                  fillColor: \"rgba(255,216,110,0.8)\",\n                  lineColor: \"transparent\"\n                },\n                textStyle: { fillColor: \"white\" },\n                px: 0,\n                py: -1,\n                x: 0,\n                y: -10,\n                aspectRatio: 0,\n                scaleWithZoom: true,\n                scaleWithSize: true,\n                maxWidth: 2,\n                padding: 2\n              }\n            ];\n          }\n        } else {\n          node.radius = 30;\n          node.items = [\n            {\n              text: \"aaa\",\n              textStyle: { fillColor: \"transparent\" },\n              backgroundStyle: {\n                fillColor: \"transparent\",\n                lineColor: \"transparent\"\n              }\n            }\n          ];\n        }\n      }\n\n      function linkStyle(link) {\n        if (link.hovered) {\n          link.radius = 2;\n          link.fillColor = \"#979797\";\n          link.shadowColor = \"#979797\";\n        } else {\n          link.radius = 1;\n          link.fillColor = \"#D8D8D8\";\n        }\n      }\n\n      function graphDoubleClick(event) {\n        event.preventDefault();\n        // console.log(\"event data:\", event.clickNode.data);\n        // console.log(\"tell me double\", event.clickNode);\n\n        if (event.clickNode === undefined) {\n          return;\n        } else if (event.clickNode.data.annotId) {\n          self.setState({\n            annotId: event.clickNode.data.annotId,\n            visible: true,\n            preTag: selectedTag\n          });\n\n          // save and restore state\n\n          setTimeout(function() {\n            var state = t.saveState();\n            self.setState(\n              {\n                newState: state\n              },\n              function() {\n                console.log(\"update state:\", self.state.newState);\n              }\n            );\n          }, 0);\n          console.log(\"check state:\", t.saveState());\n          console.log(\"the state in state\", self.state.newState);\n\n          selfProps.fetchFullAnnot(event.clickNode.data.annotId);\n        } else if (event.clickNode.data.incontext) {\n          // console.log(\"original page:\", event.clickNode.data.incontext);\n          window.open(event.clickNode.data.incontext);\n        } else if (event.clickNode.data.user) {\n          window.open(\n            \"https://hypothes.is/users/\" + event.clickNode.data.style.label\n          );\n        }\n      }\n      function graghClick(event) {\n        if (event.clickNode === undefined) {\n          return;\n        } else if (\n          event.clickNode.data.incontext &&\n          event.clickNode.data.incontext !== self.state.incontext\n        ) {\n          // console.log(\"search annot on this page:\", event.clickNode.data);\n\n          self.setState({\n            nodeId: event.clickNode.data.id,\n            incontext: event.clickNode.data.incontext,\n            backMap: true,\n            preTag: selectedTag\n          });\n\n          // save and restore state\n          setTimeout(function() {\n            var linkState = t.saveState();\n            self.setState({\n              newState: linkState\n            });\n          }, 0);\n\n          selfProps.fetchPageAnnots(event.clickNode.data.style.label);\n        }\n      }\n\n      // save and restore state\n      // function restoreNetwork(s) {\n      //   if (s !== \"\" && selectedTag === self.state.preTag) {\n      //     t.restoreState(s);\n      //   }\n      // }\n      if (\n        self.state.newState !== \"\" &&\n        selectedTag === self.state.preTag &&\n        !timeFilter\n      ) {\n        t.restoreState(self.state.newState);\n      }\n    }\n  }\n\n  handleSidebarHide = () => this.setState({ visible: false });\n\n  renderAnnots() {\n    if (this.props.passTag == \"\") {\n      return (\n        <div className=\"img-container\">\n          <img className=\"temp-image\" src={networkIcon} alt=\"network icon\" />\n          <p className=\"temp-text\">\n            <span className=\"text-color-red\">Choose</span> or{\" \"}\n            <span className=\"text-color-blue\">Search</span> the Tag <br /> to\n            Create Your Personal Learning Network\n          </p>\n        </div>\n      );\n    }\n  }\n\n  renderBack() {\n    if (this.state.backMap === true) {\n      return (\n        <div>\n          <button onClick={() => this.setState({ backMap: false })}>\n            click me and back\n          </button>\n        </div>\n      );\n    }\n  }\n\n  render() {\n    const { visible } = this.state;\n    const annotData = this.props.fullAnnots;\n    return (\n      <div className=\"map-container\">\n        <Sidebar.Pushable as={Segment}>\n          <Sidebar\n            as={Menu}\n            animation=\"overlay\"\n            icon=\"labeled\"\n            inverted\n            onHide={this.handleSidebarHide}\n            vertical\n            visible={visible}\n            width=\"wide\"\n            direction=\"right\"\n          >\n            <AnnotSidebar fullAnnots={{ annotData }} />\n          </Sidebar>\n\n          <Sidebar.Pusher>\n            <Segment basic>\n              {/* <div>{this.renderBack()}</div> */}\n              <div id=\"chartNetChart\" className=\"chart\" />\n              {/* <div>{this.renderBack()}</div> */}\n\n              {/* <p className=\"cover\" /> */}\n              <div>{this.renderAnnots()}</div>\n            </Segment>\n          </Sidebar.Pusher>\n        </Sidebar.Pushable>\n      </div>\n    );\n  }\n}\nconst mapStateToProps = state => {\n  return { fullAnnots: state.fullAnnot };\n};\n\nexport default connect(\n  mapStateToProps,\n  { fetchFullAnnot, fetchPageAnnots }\n)(NetworkMap);\n"]},"metadata":{},"sourceType":"module"}